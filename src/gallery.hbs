<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>{{title}}</title>

    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" rel="stylesheet">

</head>
<body>
<div class="px-4 py-5 my-5 text-center">
    <h1>{{title}}</h1>
    <div class="container">
        <div class="row">
            <div class="col-3">
                <label for="categories" class="form-label">Categories</label>
                <select class="form-select" aria-label="Categories" id="categories">
                    <option selected value="_">Any</option>
                    {{#each categories}}
                        <option value="{{this}}">{{this}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="col-9">
                <label for="name" class="form-label">Name</label>
                <input class="form-control" aria-label="Name" id="name" type="text" placeholder="Search...">
            </div>
        </div>
    </div>
</div>
<div class="container-fluid py-3">
    <div class="row gy-3">
        <div class="grid-sizer col-4"></div>
        {{#each mappings}}
            <div class="grid-item col-4 wallpaper">
                <div class="card">
                    <img class="card-img-top" src="{{this.medium}}" alt="{{this.name}}" loading="lazy">
                    <div class="card-body">
                        <h5 class="card-title">
                            {{this.name}}
                        </h5>
                        <p class="card-text">
                        <span class="badge" style="background: #{{this.color}}">
                            {{this.width}}x{{this.height}}
                        </span>
                            {{#if this.category}}
                                <span class="badge category" style="background: #{{this.color}}">
                                    {{this.category}}
                                </span>
                            {{/if}}
                        </p>
                        <a href="{{this.original}}" class="btn btn-primary">Original</a>
                        <a href="{{this.original}}" class="btn btn-secondary" download>Download</a>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>

</div>

<!-- Bootstrap JS -->
<script crossorigin="anonymous"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<!-- Masonry layout -->
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"
        integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous"
        async></script>

<!-- Images loaded JS -->
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>

<script>
// Reapply masonry layout after images are loaded

let $grid = $('.row').masonry({
  itemSelector: '.grid-item',
  columnWidth: '.grid-sizer',
  percentPosition: true
});

$grid.imagesLoaded().progress(function() {
  $grid.masonry('layout');
});

let category = '_';
let name = '';

function guard(e) {
    if (category === '_' && name === '') {
        return true;
    }

    const categoryMatches = $(e).find('.category').text().toLowerCase().trim() === category.toLowerCase().trim()
    const nameMatches = $(e).find('.card-title').text().toLowerCase().includes(name.toLowerCase())

    if (category === '_' && nameMatches) {
        return true;
    }

    if (name === '' && categoryMatches) {
        return true;
    }

    return categoryMatches && nameMatches
}

// Search by name
$('#name').on('input', function() {
    name = $(this).val();

    $('.wallpaper')
        .addClass('d-none')
        .filter(function(i, e) {
            return guard(e)
        })
        .removeClass('d-none');

    $grid.masonry('layout');
});

// Filter by category
$('#categories').on('change', function() {
    category = $(this).val();

    $('.wallpaper')
        .addClass('d-none')
        .filter(function(i, e) {
            return guard(e)
        })
        .removeClass('d-none');

    $grid.masonry('layout');
});
</script>
</body>
</html>